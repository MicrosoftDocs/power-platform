---
title: "Configure web channel security"
description: "Use Direct Line tokens or secrets to secure access to your bots."
keywords: "direct line, token, secret, access, secure, security, channels, PVA"
ms.date: 9/22/2020
ms.service: power-virtual-agents
ms.topic: article
author: iaanw
ms.author: iawilt
manager: shellyha
ms.reviewer: clmori
ms.custom: configuration, ceX
ms.collection: virtual-agent
---

# Configure web and Direct Line channel security

Select the version of Power Virtual Agents you're using here:

> [!div class="op_single_selector"]
> - [Power Virtual Agents web app](configure-web-security.md)
> - [Power Virtual Agents app in Microsoft Teams](teams/configure-web-security-teams.md)

When you create a Power Virtual Agents bot, it is immediately available in the **Demo website** and **Custom website** channels to anyone who knows the bot ID. These channels are available by default, and no configuration is needed. 

Users can find the bot ID directly from within Power Virtual Agents or by receiving it from someone. 

Depending on the bot's capability and sensitivity that might not be desirable. 

With Direct Line-based security, you can enable access only to locations that you control by enabling secured access with Direct Line secrets or tokens. 

You can also swap and regenerate secrets and refresh tokens, and you can easily disable secured access if you no longer want to use it.

>[!NOTE]
> Power Virtual Agents uses the [Bot Framework Direct Line channel]( /azure/bot-service/bot-service-channel-directline?view=azure-bot-service-4.0&preserve-view=true) to connect your web page or app to the bot. 

## Enable or disable web channel security

You can enforce the use of secrets and tokens for each individual bot. 

Once this option is enabled, channels will need the client to authenticate their requests either by [using a secret](#use-secrets-or-tokens) or by [using a token that is generated by using the secret](#generate-a-token), obtained at runtime.

Any access to the bot that doesn't provide this security measure won't work.

1. On the side navigation pane, select **Manage**, **Security**, and then select **Web channel security**.


    :::image type="content" source="media/configure-web-security/settings-web-channel.png" alt-text="Screenshot showing Web channel security highlighted on the Settings flyout.":::

2. Turn the **Require secured access** switch to **Enabled**. 
 

    :::image type="content" source="media/configure-web-security/enable-web-security.png" alt-text="Screenshot showing the Web channel security page.":::

>[!WARNING] 
> Once "Require secured access" is enabled or disabled, the system can take up to two hours to propagate the settings and take effect. Until then, the previous setting will be in effect. You do not need to publish the bot for this change to take effect.
>You should plan ahead to avoid exposing your bot unintentionally.

If you need to disable the web channel security option, you can do so by switching **Require secured access** to **Disabled**. Disabling secured access can take up to two hours to propagate.
 

:::image type="content" source="media/configure-web-security/disable-web-security.png" alt-text="Screenshot showing a confirmation message when disabling secured access, which says this action renders the Demo website and any Direct Line channel not using a secret or token available. This action can take up to two hours to take effect.":::

## Use secrets or tokens 

If you're creating a service-to-service app, specifying the secret in the authorization header requests may be the simplest approach. 

If you're writing an app where the client runs in a web browser or mobile app, or otherwise the code might be visible to customers, you must exchange your secret for a token. If you don't use a token, your secret can be compromised. When you're making the request to acquire the token in your service, specify the secret in the authorization header. 

Tokens only work for a single conversation and will expire unless refreshed. 

Choose the security model that works best for your situation.

>[!WARNING]
>We strongly discourage exposing the secret in any code that runs in the browser, either hard-coded or transferred through a network call.  
>Acquiring the token using the secret in your service code is the most secured way to protect your PVA bot.

## Obtain the secrets

You'll need the secret so you can specify it in your app's authorization header requests or similar.

1. On the side navigation pane, select **Manage**, **Security**, and then select **Web channel security**.

2. Select **Copy** for either **Secret 1** or **Secret 2** to copy it to the clipboard. Select the visibility icon ![Visibility icon](media/configure-web-security/visibility-icon.png "Visibility icon") to reveal the secret. A warning prompt will appear before you can reveal it.


### Swapping secrets

If you need to change the secret being used by your bot, you can do so without any downtime or interruption. 

Power Virtual Agents provides you with two secrets, which work simultaneously. You can swap the secret being used with the other one. Once the secrets are swapped and your users are all connected using the new secret, you're safe to regenerate the secret.

### Regenerating the secret

To regenerate the secret, select **Regenerate** next to the secret. 

>[!WARNING]
>Any user that is connected using the original secret or a token obtained from that secret will be disconnected.

## Generate a token

You can generate a token that can be used when starting a single bot conversation. For more information, see the section **Get Direct Line token** in the [Add bot to mobile and custom apps](publication-connect-bot-to-custom-application.md#get-direct-line-token) topic for more information.

1. [Obtain the secret](#obtain-the-secrets). 

2. Issue the following request in your service code to exchange the secret for a token. Replace `<SECRET>` with the value of the secret you obtained in Step 1. 

```html
POST https://directline.botframework.com/v3/directline/tokens/generate
Authorization: Bearer <SECRET>
```

The following snippets provide examples of the generate token request and its response.

### Sample generate token request

```html
POST https://directline.botframework.com/v3/directline/tokens/generate
Authorization: Bearer RCurR_XV9ZA.cwA.BKA.iaJrC8xpy8qbOF5xnR2vtCX7CZj0LdjAPGfiCpg4Fv0
```

### Sample generate token response

```html
HTTP/1.1 200 OK
[other headers]
```

```json
{
  "conversationId": "abc123",
  "token": "RCurR_XV9ZA.cwA.BKA.iaJrC8xpy8qbOF5xnR2vtCX7CZj0LdjAPGfiCpg4Fv0y8qbOF5xPGfiCpg4Fv0y8qqbOF5x8qbOF5xn",
  "expires_in": 1800
}
```

If the request is successful, the response contains a token that is valid for one conversation and an `expires_in` value that indicates the number of seconds until the token expires. 

For the token to remain useful, you must [refresh the token](#refresh-a-token) before it expires.

## Refresh a token

A token can be refreshed an unlimited amount of times, as long as it has not expired. 

An expired token cannot be refreshed. 

To refresh a token, issue the following request and replace `<TOKEN TO BE REFRESHED>` with the token you want to refresh.

```html
POST https://directline.botframework.com/v3/directline/tokens/refresh
Authorization: Bearer <TOKEN TO BE REFRESHED>
```

The following snippets provide examples of the refresh token request and response.

### Sample refresh request

```html
POST https://directline.botframework.com/v3/directline/tokens/refresh
Authorization: Bearer CurR_XV9ZA.cwA.BKA.iaJrC8xpy8qbOF5xnR2vtCX7CZj0LdjAPGfiCpg4Fv0y8qbOF5xPGfiCpg4Fv0y8qqbOF5x8qbOF5xn
```

### Sample refresh response

If the request is successful, the response contains a new token that is valid for the same conversation as the previous token and an `expires_in` value that indicates the number of seconds until the new token expires. 

For the new token to remain useful, you must refresh the token again before it expires.

```html
HTTP/1.1 200 OK
[other headers]
```

```json
{
  "conversationId": "abc123",
  "token": "RCurR_XV9ZA.cwA.BKA.y8qbOF5xPGfiCpg4Fv0y8qqbOF5x8qbOF5xniaJrC8xpy8qbOF5xnR2vtCX7CZj0LdjAPGfiCpg4Fv0",
  "expires_in": 1800
}
```


For more details on refreshing a token, see the section **Refresh a Direct Line token** in the [Direct Line API - Authentication]( /azure/bot-service/rest-api/bot-framework-rest-direct-line-3-0-authentication?view=azure-bot-service-4.0#refresh-token&preserve-view=true) topic.

## See also
- [Key Concepts - Publish your bot](publication-fundamentals-publish-channels.md)
- [Add bot to mobile and custom apps (web-based or native)](publication-connect-bot-to-custom-application.md)
- [Add bot to Azure Bot Service channels](publication-connect-bot-to-azure-bot-service-channels.md)

